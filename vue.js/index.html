<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson Management System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="#">üìö Lesson Management</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" :class="{ active: currentView === 'lessons' }" 
                               href="#" @click.prevent="currentView = 'lessons'">
                                Lessons
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" 
                               :class="{ 
                                   active: currentView === 'cart',
                                   disabled: cartItems.length === 0
                               }" 
                               :style="{ 
                                   cursor: cartItems.length === 0 ? 'not-allowed' : 'pointer',
                                   opacity: cartItems.length === 0 ? '0.5' : '1'
                               }"
                               href="#" 
                               @click.prevent="toggleCartView()"
                               :title="cartItems.length === 0 ? 'Add lessons to cart first' : 
                                       currentView === 'cart' ? 'Back to lessons' : 'View shopping cart'">
                                <i class="fas me-2" :class="currentView === 'cart' ? 'fa-arrow-left' : 'fa-shopping-cart'"></i>
                                <span v-if="currentView === 'cart'">Back to Lessons</span>
                                <span v-else>Cart ({{ cartItems.length }})</span>
                                <span v-if="cartItems.length === 0 && currentView !== 'cart'" class="badge bg-secondary ms-2">Empty</span>
                                <span v-else-if="currentView !== 'cart'" class="badge bg-primary ms-2">{{ cartItems.length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" :class="{ active: currentView === 'orders' }" 
                               href="#" @click.prevent="currentView = 'orders'">
                                Orders
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Lessons View -->
            <div v-if="currentView === 'lessons'">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <h2>Available Lessons</h2>
                    </div>
                    <div class="col-md-6">
                        <!-- Search and Sort Controls -->
                        <div class="row">
                            <div class="col-md-7">
                                <input 
                                    type="text" 
                                    class="form-control" 
                                    placeholder="üîç Search lessons by subject or location..." 
                                    v-model="searchQuery">
                            </div>
                            <div class="col-md-5">
                                <select class="form-select" v-model="sortBy">
                                    <option value="subject">üìö Sort by Subject</option>
                                    <option value="location">üìç Sort by Location</option>
                                    <option value="price">üí∞ Sort by Price</option>
                                    <option value="availability">üë• Sort by Spaces</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-2 d-flex justify-content-between align-items-center">
                            <button class="btn btn-sm" 
                                    :class="sortOrder === 'asc' ? 'btn-success' : 'btn-warning'"
                                    @click="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'">
                                <i class="fas me-2" :class="{
                                    'fa-sort-alpha-up': (sortBy === 'subject' || sortBy === 'location') && sortOrder === 'asc',
                                    'fa-sort-alpha-down': (sortBy === 'subject' || sortBy === 'location') && sortOrder === 'desc',
                                    'fa-sort-numeric-up': (sortBy === 'price' || sortBy === 'availability') && sortOrder === 'asc',
                                    'fa-sort-numeric-down': (sortBy === 'price' || sortBy === 'availability') && sortOrder === 'desc'
                                }"></i>
                                <strong>{{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}</strong>
                                <span class="badge bg-light text-dark ms-2">
                                    {{ sortOrder === 'asc' ? 'A‚ÜíZ' : 'Z‚ÜíA' }}
                                    <span v-if="sortBy === 'price' || sortBy === 'availability'">
                                        {{ sortOrder === 'asc' ? ' (Low‚ÜíHigh)' : ' (High‚ÜíLow)' }}
                                    </span>
                                </span>
                            </button>
                            <div class="text-end">
                                <small class="text-muted d-block">Currently sorting by:</small>
                                <strong class="text-primary">{{ 
                                    sortBy === 'subject' ? 'üìö Subject' : 
                                    sortBy === 'location' ? 'üìç Location' : 
                                    sortBy === 'price' ? 'üí∞ Price' : 
                                    sortBy === 'availability' ? 'üë• Available Spaces' : sortBy 
                                }}</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lessons Grid using v-for -->
                <div class="row">
                    <div class="col-md-4 mb-3" v-for="lesson in filteredAndSortedLessons" :key="lesson._id">
                        <div class="card h-100">
                            <div class="card-body">
                                <div class="d-flex align-items-center mb-3">
                                    <!-- Font Awesome Icon based on subject -->
                                    <i class="fas fa-2x me-3" 
                                       :class="{
                                           'fa-calculator text-primary': lesson.subject === 'Mathematics',
                                           'fa-book text-success': lesson.subject === 'English',
                                           'fa-flask text-info': lesson.subject === 'Science' || lesson.subject === 'Chemistry',
                                           'fa-landmark text-warning': lesson.subject === 'History',
                                           'fa-globe text-secondary': lesson.subject === 'Geography',
                                           'fa-palette text-danger': lesson.subject === 'Art',
                                           'fa-music text-purple': lesson.subject === 'Music',
                                           'fa-atom text-dark': lesson.subject === 'Physics',
                                           'fa-microscope text-success': lesson.subject === 'Biology'
                                       }"></i>
                                    <h5 class="card-title mb-0">{{ lesson.subject }}</h5>
                                </div>
                                <div class="card-text">
                                    <p class="mb-2">
                                        <i class="fas fa-map-marker-alt text-muted me-2"></i>
                                        <strong>Location:</strong> {{ lesson.location }}
                                    </p>
                                    <p class="mb-2">
                                        <i class="fas fa-pound-sign text-muted me-2"></i>
                                        <strong>Price:</strong> ¬£{{ lesson.price }}
                                    </p>
                                    <p class="mb-3">
                                        <i class="fas fa-users text-muted me-2"></i>
                                        <strong>Available Spaces:</strong> 
                                        <span :class="{ 'text-danger': lesson.availability === 0, 'text-success': lesson.availability > 0 }">
                                            {{ lesson.availability }}
                                        </span>
                                    </p>
                                </div>
                                <button 
                                    class="btn w-100" 
                                    :class="{
                                        'btn-secondary': lesson.availability === 0,
                                        'btn-success': cartItems.find(item => item._id === lesson._id),
                                        'btn-primary': lesson.availability > 0 && !cartItems.find(item => item._id === lesson._id)
                                    }"
                                    :disabled="lesson.availability === 0"
                                    @click="addToCart(lesson)"
                                    :title="lesson.availability === 0 ? 'No spaces available' : 
                                           cartItems.find(item => item._id === lesson._id) ? 'Already in cart' : 
                                           `Add ${lesson.subject} to cart`">
                                    <i class="fas me-2" :class="{
                                        'fa-times-circle': lesson.availability === 0,
                                        'fa-check-circle': cartItems.find(item => item._id === lesson._id),
                                        'fa-shopping-cart': lesson.availability > 0 && !cartItems.find(item => item._id === lesson._id)
                                    }"></i>
                                    {{ lesson.availability === 0 ? 'Sold Out' : 
                                       cartItems.find(item => item._id === lesson._id) ? 'In Cart' : 
                                       'Add to Cart' }}
                                    <span v-if="lesson.availability > 0" class="badge bg-light text-dark ms-2">
                                        {{ lesson.availability }} left
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="filteredAndSortedLessons.length === 0" class="alert alert-info text-center">
                    <i class="fas fa-info-circle me-2"></i>
                    No lessons found matching your search criteria.
                </div>

                <!-- Sorting Information Display -->
                <div v-if="filteredAndSortedLessons.length > 0" class="alert alert-light border mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <i class="fas fa-sort me-2 text-primary"></i>
                            <strong>Sorting Results:</strong> 
                            Showing {{ filteredAndSortedLessons.length }} lessons sorted by 
                            <span class="badge bg-primary">{{ 
                                sortBy === 'subject' ? 'Subject' : 
                                sortBy === 'location' ? 'Location' : 
                                sortBy === 'price' ? 'Price' : 
                                'Available Spaces' 
                            }}</span>
                            in 
                            <span class="badge" :class="sortOrder === 'asc' ? 'bg-success' : 'bg-warning'">
                                {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }}
                            </span> 
                            order
                        </div>
                        <div class="col-md-4 text-end">
                            <small class="text-muted">
                                <i class="fas fa-lightbulb me-1"></i>
                                Click the sort button to reverse order
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Button State Information -->
                <div class="alert alert-info mb-4" v-if="filteredAndSortedLessons.some(lesson => lesson.availability === 0)">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Button States:</strong>
                            <span class="badge bg-primary ms-2">üîµ Available</span>
                            <span class="badge bg-success ms-2">üü¢ In Cart</span>
                            <span class="badge bg-secondary ms-2">‚ö´ Sold Out (Disabled)</span>
                        </div>
                        <div class="col-md-4 text-end">
                            <small class="text-muted">
                                <i class="fas fa-ban me-1"></i>
                                Sold out buttons are disabled but visible
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Cart Status Information -->
                <div class="alert mb-4" :class="cartItems.length === 0 ? 'alert-warning' : 'alert-success'">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <i class="fas me-2" :class="cartItems.length === 0 ? 'fa-shopping-cart' : 'fa-check-circle'"></i>
                            <strong v-if="cartItems.length === 0">Shopping Cart Status:</strong>
                            <strong v-else>Shopping Cart Ready:</strong>
                            <span v-if="cartItems.length === 0" class="text-muted ms-2">
                                Cart is empty - add lessons to enable cart toggle navigation
                            </span>
                            <span v-else class="ms-2">
                                {{ cartItems.length }} item{{ cartItems.length !== 1 ? 's' : '' }} in cart - 
                                <a href="#" @click.prevent="toggleCartView()" class="alert-link">
                                    {{ currentView === 'cart' ? 'Back to Lessons' : 'Toggle to Cart' }}
                                </a>
                            </span>
                        </div>
                        <div class="col-md-4 text-end">
                            <span v-if="cartItems.length === 0" class="badge bg-secondary">
                                <i class="fas fa-lock me-1"></i>Cart Disabled
                            </span>
                            <span v-else class="badge bg-success">
                                <i class="fas fa-exchange-alt me-1"></i>Toggle Enabled
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cart View -->
            <div v-if="currentView === 'cart'">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-shopping-cart me-2"></i>Shopping Cart</h2>
                    <div class="text-muted">
                        <i class="fas fa-list me-1"></i>
                        {{ cartItems.length }} item{{ cartItems.length !== 1 ? 's' : '' }} in cart
                    </div>
                </div>
                
                <div v-if="cartItems.length === 0" class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    Your cart is empty. <a href="#" @click.prevent="toggleCartView()" class="alert-link">Browse lessons</a>
                </div>

                <div v-else>
                    <!-- Cart Items -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-body">
                                    <div v-for="item in cartItems" :key="item._id" class="row align-items-center mb-3 pb-3 border-bottom">
                                        <div class="col-md-3">
                                            <div class="d-flex align-items-center">
                                                <i class="fas me-2" :class="{
                                                    'fa-calculator text-primary': item.subject === 'Mathematics',
                                                    'fa-book text-success': item.subject === 'English',
                                                    'fa-flask text-info': item.subject === 'Science' || item.subject === 'Chemistry',
                                                    'fa-landmark text-warning': item.subject === 'History',
                                                    'fa-globe text-secondary': item.subject === 'Geography',
                                                    'fa-palette text-danger': item.subject === 'Art',
                                                    'fa-music text-purple': item.subject === 'Music',
                                                    'fa-atom text-dark': item.subject === 'Physics',
                                                    'fa-microscope text-success': item.subject === 'Biology'
                                                }"></i>
                                                <div>
                                                    <strong>{{ item.subject }}</strong>
                                                    <span v-if="item.quantity > 1" class="badge bg-primary ms-2">{{ item.quantity }}x</span>
                                                    <br>
                                                    <small class="text-muted">Lesson ID: {{ item._id }}</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <i class="fas fa-map-marker-alt text-muted me-1"></i>
                                            <strong>{{ item.location }}</strong>
                                        </div>
                                        <div class="col-md-2">
                                            <i class="fas fa-pound-sign text-muted me-1"></i>
                                            ¬£{{ item.price }}
                                            <small class="text-muted d-block" v-if="item.quantity > 1">
                                                per lesson
                                            </small>
                                        </div>
                                        <div class="col-md-2">
                                            <strong class="text-success">¬£{{ (item.price * (item.quantity || 1)).toFixed(2) }}</strong>
                                            <small class="text-muted d-block">subtotal</small>
                                        </div>
                                        <div class="col-md-3">
                                            <div v-if="item.quantity > 1" class="btn-group w-100 mb-2">
                                                <button class="btn btn-outline-warning btn-sm" @click="removeOneSpace(item._id)"
                                                        :title="`Remove 1 space of ${item.subject}`">
                                                    <i class="fas fa-minus me-1"></i>-1
                                                </button>
                                                <button class="btn btn-danger btn-sm" @click="removeFromCart(item._id)"
                                                        :title="`Remove all ${item.quantity} spaces of ${item.subject}`">
                                                    <i class="fas fa-trash me-1"></i>All
                                                </button>
                                            </div>
                                            <button v-else class="btn btn-danger btn-sm w-100" @click="removeFromCart(item._id)"
                                                    :title="`Remove ${item.subject} from cart`">
                                                <i class="fas fa-trash me-1"></i>Remove
                                            </button>
                                        </div>
                                    </div>
                                    <!-- Cart Summary -->
                                    <div class="row mt-4 pt-3 border-top">
                                        <div class="col-md-6">
                                            <h6><i class="fas fa-chart-bar me-2"></i>Cart Summary</h6>
                                            <ul class="list-unstyled mb-0">
                                                <li><strong>Total Items:</strong> {{ cartItems.length }} lesson type{{ cartItems.length !== 1 ? 's' : '' }}</li>
                                                <li><strong>Total Spaces:</strong> {{ cartItems.reduce((total, item) => total + (item.quantity || 1), 0) }} space{{ cartItems.reduce((total, item) => total + (item.quantity || 1), 0) !== 1 ? 's' : '' }}</li>
                                                <li><strong>Average Price:</strong> ¬£{{ cartItems.length > 0 ? (cartTotal / cartItems.reduce((total, item) => total + (item.quantity || 1), 0)).toFixed(2) : '0.00' }} per space</li>
                                            </ul>
                                        </div>
                                        <div class="col-md-6 text-end">
                                            <h5 class="text-success">
                                                <i class="fas fa-pound-sign me-1"></i>
                                                Total: ¬£{{ cartTotal.toFixed(2) }}
                                            </h5>
                                            <small class="text-muted">All lessons included</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Checkout Form -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-credit-card me-2"></i>Checkout Information</h5>
                                </div>
                                <div class="card-body">
                                    <form @submit.prevent="checkout">
                                        <div class="mb-3">
                                            <label for="name" class="form-label">
                                                <i class="fas fa-user me-2"></i>Full Name *
                                            </label>
                                            <input 
                                                type="text" 
                                                class="form-control" 
                                                :class="{ 
                                                    'is-valid': isValidName, 
                                                    'is-invalid': orderForm.name && !isValidName 
                                                }"
                                                id="name"
                                                v-model="orderForm.name" 
                                                placeholder="Letters only (e.g., JohnSmith)"
                                                required>
                                            <div class="invalid-feedback">
                                                Name must be letters only (no spaces, numbers, or special characters). Minimum 2 characters.
                                            </div>
                                            <div class="valid-feedback">
                                                Perfect! Letters only name accepted.
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="phone" class="form-label">
                                                <i class="fas fa-phone me-2"></i>Phone Number *
                                            </label>
                                            <input 
                                                type="tel" 
                                                class="form-control" 
                                                :class="{ 
                                                    'is-valid': isValidPhone, 
                                                    'is-invalid': orderForm.phone && !isValidPhone 
                                                }"
                                                id="phone"
                                                v-model="orderForm.phone" 
                                                placeholder="Numbers only (e.g., 1234567890)"
                                                required>
                                            <div class="invalid-feedback">
                                                Phone must be numbers only (no letters, spaces, or special characters). Minimum 10 digits.
                                            </div>
                                            <div class="valid-feedback">
                                                Perfect! Numbers only phone accepted.
                                            </div>
                                        </div>
                                        
                                        <!-- Form Validation Status -->
                                        <div class="alert mb-3" :class="isFormValid ? 'alert-success' : 'alert-warning'">
                                            <i class="fas me-2" :class="isFormValid ? 'fa-check-circle' : 'fa-exclamation-triangle'"></i>
                                            <strong v-if="isFormValid">Ready to checkout!</strong>
                                            <strong v-else>Please complete the form:</strong>
                                            <ul class="mb-0 mt-2" v-if="!isFormValid">
                                                <li v-if="!isValidName">Name: Letters only, minimum 2 characters</li>
                                                <li v-if="!isValidPhone">Phone: Numbers only, minimum 10 digits</li>
                                            </ul>
                                        </div>
                                        
                                        <button type="submit" 
                                                class="btn w-100" 
                                                :class="isFormValid ? 'btn-success' : 'btn-secondary'"
                                                :disabled="!isFormValid"
                                                :title="isFormValid ? 'Place your order' : 'Please complete all required fields'">
                                            <i class="fas me-2" :class="isFormValid ? 'fa-check' : 'fa-lock'"></i>
                                            <span v-if="isFormValid">Place Order (¬£{{ cartTotal.toFixed(2) }})</span>
                                            <span v-else>Complete Form to Place Order</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders View -->
            <div v-if="currentView === 'orders'">
                <h2><i class="fas fa-receipt me-2"></i>Order History</h2>
                
                <div v-if="orders.length === 0" class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    No orders found.
                </div>

                <div v-else>
                    <div v-for="order in orders" :key="order._id" class="card mb-3">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-6">
                                    <strong><i class="fas fa-hashtag me-1"></i>Order #{{ order._id.slice(-8) }}</strong>
                                </div>
                                <div class="col-md-6 text-end">
                                    <i class="fas fa-calendar me-1"></i>
                                    {{ new Date(order.createdAt).toLocaleDateString() }}
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><i class="fas fa-user me-2"></i><strong>Customer:</strong> {{ order.name }}</p>
                                    <p><i class="fas fa-phone me-2"></i><strong>Phone:</strong> {{ order.phone }}</p>
                                </div>
                                <div class="col-md-6 text-end">
                                    <h5><i class="fas fa-pound-sign me-1"></i>Total: ¬£{{ order.total }}</h5>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <h6><i class="fas fa-list me-2"></i>Lessons:</h6>
                                    <ul class="list-group list-group-flush">
                                        <li v-for="lesson in order.lessons" :key="lesson._id" 
                                            class="list-group-item d-flex justify-content-between">
                                            <span><i class="fas fa-book me-2"></i>{{ lesson.subject }} - {{ lesson.location }}</span>
                                            <span>¬£{{ lesson.price }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Vue.js Application Code -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentView: 'lessons',
                    lessons: [],
                    cartItems: [],
                    orders: [],
                    searchQuery: '',
                    sortBy: 'subject',
                    sortOrder: 'asc',
                    orderForm: {
                        name: '',
                        phone: ''
                    },
                    apiBaseUrl: 'https://your-api-url.com/api' // Update this with your deployed API URL
                }
            },
            computed: {
                filteredAndSortedLessons() {
                    let filtered = this.lessons;
                    
                    // Filter by search query
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(lesson => 
                            lesson.subject.toLowerCase().includes(query) ||
                            lesson.location.toLowerCase().includes(query)
                        );
                    }
                    
                    // Sort lessons by selected attribute
                    filtered.sort((a, b) => {
                        let aValue = a[this.sortBy];
                        let bValue = b[this.sortBy];
                        
                        // Handle different data types for sorting
                        if (this.sortBy === 'price' || this.sortBy === 'availability') {
                            // Numeric sorting for price and availability
                            aValue = Number(aValue);
                            bValue = Number(bValue);
                        } else {
                            // String sorting for subject and location (case-insensitive)
                            aValue = String(aValue).toLowerCase();
                            bValue = String(bValue).toLowerCase();
                        }
                        
                        // Apply sort order (ascending or descending)
                        if (this.sortOrder === 'asc') {
                            return aValue < bValue ? -1 : aValue > bValue ? 1 : 0;
                        } else {
                            return aValue > bValue ? -1 : aValue < bValue ? 1 : 0;
                        }
                    });
                    
                    return filtered;
                },
                cartTotal() {
                    return this.cartItems.reduce((total, item) => total + (item.price * (item.quantity || 1)), 0);
                },
                
                // Form validation computed properties using JavaScript regular expressions
                isValidName() {
                    // Name must be LETTERS ONLY (no spaces, numbers, or special characters)
                    const nameRegex = /^[a-zA-Z]{2,}$/;
                    const isValid = this.orderForm.name && nameRegex.test(this.orderForm.name.trim());
                    
                    // Debug logging for validation
                    if (this.orderForm.name) {
                        console.log(`Name validation: "${this.orderForm.name}" ‚Üí ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'} (letters only)`);
                    }
                    
                    return isValid;
                },
                
                isValidPhone() {
                    // Phone must be NUMBERS ONLY (no letters, spaces, or special characters)
                    const phoneRegex = /^[0-9]{10,}$/;
                    const isValid = this.orderForm.phone && phoneRegex.test(this.orderForm.phone.trim());
                    
                    // Debug logging for validation
                    if (this.orderForm.phone) {
                        console.log(`Phone validation: "${this.orderForm.phone}" ‚Üí ${isValid ? '‚úÖ Valid' : '‚ùå Invalid'} (numbers only, 10+ digits)`);
                    }
                    
                    return isValid;
                },
                
                isFormValid() {
                    return this.isValidName && this.isValidPhone;
                }
            },
            methods: {
                async fetchLessons() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/lessons`);
                        if (response.ok) {
                            this.lessons = await response.json();
                        } else {
                            console.error('Failed to fetch lessons');
                            // Fallback to mock data for development
                            this.loadMockData();
                        }
                    } catch (error) {
                        console.error('Error fetching lessons:', error);
                        // Fallback to mock data for development
                        this.loadMockData();
                    }
                },
                
                async fetchOrders() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/orders`);
                        if (response.ok) {
                            this.orders = await response.json();
                        }
                    } catch (error) {
                        console.error('Error fetching orders:', error);
                    }
                },
                
                addToCart(lesson) {
                    // Prevent adding if no spaces available (double-check safety)
                    if (lesson.availability <= 0) {
                        console.warn(`Cannot add ${lesson.subject} to cart: No spaces available (${lesson.availability})`);
                        return; // Exit early, do nothing
                    }
                    
                    // Only proceed if spaces are available
                    if (lesson.availability > 0) {
                        // Check if this is the first item being added to cart
                        const wasCartEmpty = this.cartItems.length === 0;
                        
                        // Check if lesson is already in cart
                        const existingItem = this.cartItems.find(item => item._id === lesson._id);
                        if (!existingItem) {
                            // Add new lesson to cart with quantity 1
                            this.cartItems.push({ ...lesson, quantity: 1 });
                        } else {
                            // Increase quantity if already in cart
                            existingItem.quantity++;
                        }
                        
                        // Show special message when cart becomes enabled for the first time
                        if (wasCartEmpty && this.cartItems.length > 0) {
                            console.log('üõí Shopping Cart is now ENABLED! You can access the cart navigation.');
                        }
                        
                        // Decrease availability in the lessons array by 1
                        const lessonIndex = this.lessons.findIndex(l => l._id === lesson._id);
                        if (lessonIndex !== -1) {
                            this.lessons[lessonIndex].availability--;
                            
                            // Log the action with updated availability
                            const newAvailability = this.lessons[lessonIndex].availability;
                            console.log(`‚úÖ Added 1 space of ${lesson.subject} to cart. ${newAvailability} spaces remaining.`);
                            
                            // Special message when lesson becomes sold out
                            if (newAvailability === 0) {
                                console.log(`üö´ ${lesson.subject} is now SOLD OUT - button will be disabled`);
                            }
                        }
                    }
                },
                
                removeFromCart(lessonId) {
                    const itemIndex = this.cartItems.findIndex(item => item._id === lessonId);
                    if (itemIndex !== -1) {
                        const cartItem = this.cartItems[itemIndex];
                        const quantityToRestore = cartItem.quantity || 1;
                        
                        // Increase availability back in lessons array by the quantity
                        const lessonIndex = this.lessons.findIndex(l => l._id === lessonId);
                        if (lessonIndex !== -1) {
                            const oldAvailability = this.lessons[lessonIndex].availability;
                            this.lessons[lessonIndex].availability += quantityToRestore;
                            const newAvailability = this.lessons[lessonIndex].availability;
                            
                            console.log(`üîÑ Removed ${cartItem.subject} from cart:`);
                            console.log(`   - Quantity removed: ${quantityToRestore} space${quantityToRestore > 1 ? 's' : ''}`);
                            console.log(`   - Availability restored: ${oldAvailability} ‚Üí ${newAvailability}`);
                            console.log(`   - ${cartItem.subject} is now available again in lesson list`);
                        }
                        
                        // Remove entire item from cart
                        this.cartItems.splice(itemIndex, 1);
                        
                        // Show user feedback
                        console.log(`‚úÖ ${cartItem.subject} successfully removed from cart and restored to lesson list`);
                        
                        // If cart becomes empty, provide guidance
                        if (this.cartItems.length === 0) {
                            console.log('üõí Cart is now empty - you can browse lessons to add more items');
                        }
                    }
                },
                
                removeOneSpace(lessonId) {
                    const itemIndex = this.cartItems.findIndex(item => item._id === lessonId);
                    if (itemIndex !== -1) {
                        const cartItem = this.cartItems[itemIndex];
                        
                        // Increase availability back in lessons array by 1
                        const lessonIndex = this.lessons.findIndex(l => l._id === lessonId);
                        if (lessonIndex !== -1) {
                            this.lessons[lessonIndex].availability += 1;
                            console.log(`‚ûñ Removed 1 space of ${cartItem.subject} from cart`);
                            console.log(`   - Availability increased: ${this.lessons[lessonIndex].availability - 1} ‚Üí ${this.lessons[lessonIndex].availability}`);
                        }
                        
                        // Decrease quantity by 1
                        cartItem.quantity -= 1;
                        
                        // If quantity becomes 0, remove the item entirely
                        if (cartItem.quantity <= 0) {
                            this.cartItems.splice(itemIndex, 1);
                            console.log(`‚úÖ ${cartItem.subject} completely removed from cart (quantity reached 0)`);
                        } else {
                            console.log(`‚úÖ ${cartItem.subject} quantity reduced to ${cartItem.quantity}`);
                        }
                    }
                },
                
                toggleCartView() {
                    // Only allow toggle if cart has items (prevent access to empty cart)
                    if (this.cartItems.length === 0) {
                        console.warn('Cannot access cart: Cart is empty. Add lessons first.');
                        return;
                    }
                    
                    // Toggle between lessons and cart views
                    if (this.currentView === 'cart') {
                        this.currentView = 'lessons';
                        console.log('üìö Switched back to lessons view');
                    } else {
                        this.currentView = 'cart';
                        console.log('üõí Switched to cart view');
                    }
                },
                
                async checkout() {
                    // Validate cart is not empty
                    if (this.cartItems.length === 0) {
                        console.warn('Cannot checkout: Cart is empty');
                        return;
                    }
                    
                    // Validate form before proceeding
                    if (!this.isFormValid) {
                        console.warn('Cannot checkout: Form validation failed');
                        alert('Please complete all required fields with valid information before placing your order.');
                        return;
                    }
                    
                    console.log('‚úÖ Form validation passed - proceeding with checkout');
                    
                    const orderData = {
                        name: this.orderForm.name,
                        phone: this.orderForm.phone,
                        lessons: this.cartItems.map(item => ({
                            _id: item._id,
                            subject: item.subject,
                            location: item.location,
                            price: item.price
                        })),
                        total: this.cartTotal
                    };
                    
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/orders`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(orderData)
                        });
                        
                        if (response.ok) {
                            const newOrder = await response.json();
                            this.orders.unshift(newOrder);
                            
                            // Create detailed confirmation message
                            const orderSummary = this.cartItems.map(item => 
                                `‚Ä¢ ${item.subject} (${item.quantity || 1}x) - ${item.location} - ¬£${(item.price * (item.quantity || 1)).toFixed(2)}`
                            ).join('\n');
                            
                            const confirmationMessage = `üéâ ORDER CONFIRMED! üéâ

üìã Order Details:
Customer: ${orderData.name}
Phone: ${orderData.phone}
Order Total: ¬£${orderData.total.toFixed(2)}

üìö Lessons Ordered:
${orderSummary}

‚úÖ Your order has been successfully submitted!
üìß You will receive a confirmation shortly.
üì± We may contact you at ${orderData.phone} if needed.

Thank you for choosing our lesson service!`;

                            // Display confirmation message
                            alert(confirmationMessage);
                            console.log('üéâ Order successfully placed:', newOrder);
                            
                            // Update lesson availability on server
                            for (const item of this.cartItems) {
                                await this.updateLessonAvailability(item._id, -1);
                            }
                            
                            // Clear cart and form
                            this.cartItems = [];
                            this.orderForm.name = '';
                            this.orderForm.phone = '';
                            
                            // Navigate to orders view to show the new order
                            this.currentView = 'orders';
                        } else {
                            const errorMessage = `‚ùå ORDER FAILED

Sorry, we couldn't process your order at this time.

Please check:
‚Ä¢ Your internet connection
‚Ä¢ Try again in a few moments
‚Ä¢ Contact support if the problem persists

Your cart items have been preserved.`;
                            
                            alert(errorMessage);
                            console.error('Order submission failed:', response.status, response.statusText);
                        }
                    } catch (error) {
                        console.error('Error placing order:', error);
                        
                        const networkErrorMessage = `üåê CONNECTION ERROR

Unable to connect to our servers.

Possible causes:
‚Ä¢ Network connection issues
‚Ä¢ Server temporarily unavailable
‚Ä¢ Firewall or security software blocking the request

Please:
‚Ä¢ Check your internet connection
‚Ä¢ Try again in a few minutes
‚Ä¢ Contact support if the issue persists

Your cart has been preserved.`;
                        
                        alert(networkErrorMessage);
                    }
                },
                
                async updateLessonAvailability(lessonId, change) {
                    try {
                        await fetch(`${this.apiBaseUrl}/lessons/${lessonId}/availability`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ change })
                        });
                    } catch (error) {
                        console.error('Error updating lesson availability:', error);
                    }
                },
                
                loadMockData() {
                    // Mock data for development/testing - 10 lessons with at least 5 spaces each
                    this.lessons = [
                        {
                            _id: '1',
                            subject: 'Mathematics',
                            location: 'London',
                            price: 25,
                            availability: 5
                        },
                        {
                            _id: '2',
                            subject: 'English',
                            location: 'Manchester',
                            price: 20,
                            availability: 5
                        },
                        {
                            _id: '3',
                            subject: 'Science',
                            location: 'Birmingham',
                            price: 30,
                            availability: 8
                        },
                        {
                            _id: '4',
                            subject: 'History',
                            location: 'Liverpool',
                            price: 22,
                            availability: 5
                        },
                        {
                            _id: '5',
                            subject: 'Geography',
                            location: 'Leeds',
                            price: 18,
                            availability: 6
                        },
                        {
                            _id: '6',
                            subject: 'Art',
                            location: 'Bristol',
                            price: 28,
                            availability: 5
                        },
                        {
                            _id: '7',
                            subject: 'Music',
                            location: 'Edinburgh',
                            price: 35,
                            availability: 5
                        },
                        {
                            _id: '8',
                            subject: 'Physics',
                            location: 'Glasgow',
                            price: 32,
                            availability: 7
                        },
                        {
                            _id: '9',
                            subject: 'Chemistry',
                            location: 'Cardiff',
                            price: 29,
                            availability: 5
                        },
                        {
                            _id: '10',
                            subject: 'Biology',
                            location: 'Belfast',
                            price: 27,
                            availability: 5
                        }
                    ];
                }
            },
            
            mounted() {
                this.fetchLessons();
                this.fetchOrders();
            }
        }).mount('#app');
    </script>
</body>
</html>